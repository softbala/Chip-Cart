import { Component } from '@angular/core';
import { CartService } from '../services/cart.service';
@Component({selector:'app-checkout', template: `<h2>Checkout</h2><div *ngIf="cart.items.length===0">Cart empty</div><div *ngIf="cart.items.length>0"><div *ngFor="let i of cart.items">{{i.title}} x {{i.qty}}</div><div class="mt-3"><button class="btn btn-primary" (click)="stripe()">Stripe</button><button class="btn btn-warning ms-2" (click)="razorpay()">Razorpay</button><button class="btn btn-secondary ms-2" (click)="paytm()">Paytm</button></div></div>`})
export class CheckoutComponent { constructor(public cart: CartService) {} async stripe(){ const res = await fetch('/api/checkout', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ items: this.cart.items })}); const data = await res.json(); if(data.sessionId){ const stripe = await (await import('@stripe/stripe-js')).loadStripe(data.publishableKey); await (await stripe).redirectToCheckout({ sessionId: data.sessionId }); } else alert('Stripe error'); } async razorpay(){ const amount = this.cart.items.reduce((s,i)=> s + i.price*i.qty, 0); const res = await fetch('/api/razorpay/order', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ amount })}); const data = await res.json(); if(data && data.id){ const options:any = { key: (window as any).RAZORPAY_KEY || '', amount: data.amount, currency: data.currency, order_id: data.id, handler: (r:any)=> alert('Paid: '+r.razorpay_payment_id) }; const rz = new (window as any).Razorpay(options); rz.open(); } else alert('Razorpay error'); } async paytm(){ const orderId = 'ORDER_' + Date.now(); const amount = this.cart.items.reduce((s,i)=> s + i.price*i.qty, 0) / 100; const res = await fetch('/api/paytm/initiate', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ orderId, amount, customerId: 'CUST_1' })}); const data = await res.json(); console.log('Paytm initiate response', data); alert('Check server logs for Paytm response.'); } }